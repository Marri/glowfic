- content_for :breadcrumbs do
  - unless @user.id == current_user.try(:id)
    = user_link(@user)
    &raquo;
    %b #{@user.username}'s Characters

%table
  %tr
    %th.table-title{colspan: (character_split == 'none' ? 7 : 6)}
      - if @group
        Character Group:
        = @group.name
      - elsif @user.id == current_user&.id
        Your Characters
        = link_to new_character_path(character_group_id: @group.try(:id)) do
          .link-box.action-new + New Character
        = link_to new_template_path do
          .link-box.action-new + New Template
      - else
        = @user.username + "'s Characters"
      = link_to url_for(character_split: character_split, view: 'icons') do
        .view-button{class: (:selected unless page_view == 'list')}
          = image_tag "icons/grid.png", class: 'icon-view', alt: ''
          Icons
      = link_to url_for(character_split: character_split, view: 'list') do
        .view-button{class: (:selected if page_view == 'list')}
          = image_tag "icons/list.png", class: 'list-view', alt: ''
          List
      - if character_split == 'template'
        = link_to url_for(character_split: 'none', view: params[:view]) do
          .view-button
            Ungroup
      - else
        = link_to url_for(character_split: 'template', view: params[:view]) do
          .view-button
            Group
  - partial_type = (page_view == 'list') ? 'characters/list_section' : 'characters/icon_view'
  - colspan = (page_view == 'list') ? 6 : 1
  %tr
    %th.subber.padding-10{colspan: colspan}
      = form_tag search_characters_path, method: :get do
        = label_tag :name, 'Search by name:'
        = text_field_tag :name, params[:name], style: 'margin: 0px 5px;', id: :name
        = hidden_field_tag :author_id, @user.id
        = hidden_field_tag :search_name, true
        = hidden_field_tag :search_screenname, true
        = hidden_field_tag :search_nickname, true
        = submit_tag "Search", class: 'button'
  %tr
    %th.odd{style: 'padding: 3px', colspan: colspan}
  - if character_split == 'template'
    - if @group
      = render 'group', group: @group, characters: @characters, page_view: page_view, colspan: colspan, settings: @settings, no_header: true
    - elsif @user.character_groups.exists?
      - collection_locals = { page_view: page_view, characters: @characters, settings: @settings, colspan: colspan, select_characters: true }
      = render partial: 'group', collection: @user.character_groups.order(id: :asc), locals: collection_locals
      - if @characters.key?(nil)
        = render 'group', group: nil, characters: @characters[nil], page_view: page_view, settings: @settings, colspan: colspan
    - elsif @characters.present?
      = render partial: partial_type, collection: @user.templates, as: :name, locals: { characters: @characters, settings: @settings, select_characters: true }
      - if @characters.key?(nil)
        = render partial_type, name: "No Template", characters: @characters[nil], show_new_character_button: @user.id == current_user&.id, settings: @settings
    - else
      %tr
        %td.centered.padding-5{class: cycle('even', 'odd'), colspan: colspan} — No characters yet —
  - else
    = render partial_type, name: nil, characters: @characters, settings: @settings, show_template: true
